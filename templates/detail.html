<!doctype html>
<html lang="en">
    <!-- Webpage Title -->
    <title>STOCKCOIN</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <meta property="og:title" content="STOCKCOIN"/>
    <meta property="og:description" content="내게 필요한 주식, 코인 앱 정보를 한눈에"/>
    <meta property="og:image" content="{{ url_for('static', filename='ogimg.png') }}"/>
 <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bulma CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
      <!-- google font -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap" rel="stylesheet">

      <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">


    <!-- Font Awesome CSS -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>


    <script>
        let users = {{ result2|tojson }};
        let users_list = [];
        for (let i = 0; i < users.length; i++) {
            users_list.push(users[i]['username'])
        }
        console.log(users_list)

        function sign_out() {
            $.removeCookie('mytoken', {path: '/'});
            alert('로그아웃 되었습니다.')
            window.location.href = "/login"
        }

        function postReview(user_name) {
            let username = user_name
            let appname = '{{ result.app_name }}'
            let comment = $('#post-comment').val()
            let star1 = $('#select1').val()
            let star2 = $('#select2').val()
            let star3 = $('#select3').val()

            $.ajax({
                type: "POST",
                url: "/review",
                data: {
                    username_give: username,
                    appname_give: appname,
                    comment_give: comment,
                    star1_give: star1,
                    star2_give: star2,
                    star3_give: star3
                },
                success: function (response) { // 성공하면
                    alert(response["msg"]);
                    window.location.reload()
                }
            })
        }

        function openClose(user_name) {
            if (users_list.includes(user_name)) {
                alert('이미 리뷰를 작성했습니다.')
                return
            }
            if ($("#post-box").css("display") == "none") {
                $("#post-box").show();
                $("#btn-post-box").text("리뷰작성닫기");
            } else {
                $("#post-box").hide();
                $("#btn-post-box").text("리뷰작성하기");
            }
        }


        function review() {
            alert('로그인 해주세요')
            window.location.href = '/login'
            return
        }

    </script>
    <style>
          * {
            font-family: 'Nanum Gothic', sans-serif;
        }
        html, body {
                background-color: black;
                height:100%;
            }

          .nav {
              background-color: black;
              width: 100%;
              height: 60px;
              position: fixed;
              top: 0;
              z-index: 1;
              margin-top: 0;
              display: flex;
              align-items: center;
          }

          .logo {
              width: 170px;
              margin-left: 20px;

          }

          .login {
              position: absolute;
              right: 15px;
              top: 25%;
              font-size: 15px;
              z-index: 1;
          }

          .signin:hover {
              border-bottom: 2px solid #DBFC52;
          }

          .user {
              display: inline-block;
              margin-right: 25px;
              z-index: 1;
              font-size: 15px;
          }

          .user:hover {
              display: inline-block;
              margin-right: 25px;
              z-index: 1;
              font-size: 15px;
              border-bottom: 2px solid #DBFC52;
          }
        .signout {
            display: inline-block;
            z-index: 1;
            font-size: 15px;
        }
        .signout:hover {
            display: inline-block;
            z-index: 1;
            font-size: 15px;
            border-bottom: 2px solid #DBFC52;
        }

        button {
            width: 30%;
            background-color: black;
            border: 0px solid;
            border-radius: 0;
            color: #DBFC52;
            padding:  10px;
            text-weight: 2px border;
        }
         button:hover {
            width: 30%;
            background-color: #DBFC52;
            border: 0px solid;
            border-radius: 0;
            color: black;
            padding:  10px;
            text-weight: 2px border;
        }

    .card-one {
        border: 2px solid;
        margin: 30px auto;
        padding: 20px;
        width: 90%;
        background-color: white;

    }
     .card {
            background-color: white;
            padding: 15px;
            box-sizing: border-box;
            border-radius: 0;

        }


    </style>

    </head>
    <body>

        <div class="nav">
            <div class="logo" onclick="window.location.href='/'">
                <img src="../static/logo2.png" alt="">
            </div>

            <div class="login">
                {% if user_info %}
                    <div style="" class="user">
                        <a onclick="window.location.href='/user/{{ user_info.username }}'"
                           style="color: white; text-decoration:none;">-> {{ user_info.username }} </a>
                    </div>

                    <div style="display: inline-block" class="signout">
                        <a onclick="sign_out()" style="color: white; text-decoration:none;">sign out</a>
                    </div>

                {% else %}
                    <a href="/login" class="signin" style="color: white; text-decoration:none;">sign in / sign up</a>
                {% endif %}
            </div>
        </div>



{#리뷰정보 불러오기#}
<div id="card" class="card-one">



{#부트스트랩 #}
<div class="container"  style="justify-content: center; padding-top: 30px;">

    <div style="width: 250px; margin: 0px auto 0px auto;" class="card">
        <img class="card-img-top" src="{{ result.image_url }}" alt="Card image cap">
        <div class="card-body">
            <h5 class="card-title" style="font-size: 17px; font-weight: bold">{{ result.app_name }}</h5>
            <p class="card-text" style="font-size: 13px;">{{ result.company }}</p>
            {% if  star4 %}
            <p class="card-text" style="font-size: 13px;">보안: {{ star1 }} / 접근성: {{ star2 }} / 디자인: {{ star3 }} <br> 총점: {{ star4 }}</p>
            {% else %}
            <p class="card-text" style="font-size: 13px;">앱을 평가해 주세요!</p>
            {% endif %}

        </div>
    </div>


        <table class="table" style="font-size: 13px; margin-top: 30px; text-align: center">
            <thead style="background-color: #DBFC52; white-space:nowrap;">
            <tr >
                <th scope="col">ID</th>
                <th class="col" scope="col">코멘트</th>
                <th scope="col">보안</th>
                <th scope="col">접근성</th>
                <th scope="col">디자인</th>
            </tr>
            </thead>

            <tbody>
            {% for i in result2 %}
            <tr>
                <th scope="row">{{ i.username }}</th>
                <td>{{ i.comment }}</td>
                <td>{{ i.star1 }}</td>
                <td>{{ i.star2 }}</td>
                <td>{{ i.star3 }}</td>

            </tr>
            {% endfor %}


            </tbody>
        </table>

{% if user_info %}
    <button type="button" class="buttonwrap" onclick="openClose('{{ user_info.username }}')">리뷰작성하기</button>
{% else %}
<button type="button" class="buttonwrap" onclick="alert('로그인 후 작성해 주세요')">리뷰작성하기</button>
{% endif %}
</div>

{% if user_info %}

    <div id="post-box" style="display:none">
        <div class="comment">
            <br>
            <a>리뷰 코멘트</a>
            <br>
            <textarea id="post-comment" class="form-control" rows="4"></textarea>
        </div>

        <div class="left">
            만족도
            <select id="select1">
                <option value="1">1점</option>
                <option value="2">2점</option>
                <option value="3">3점</option>
                <option value="4">4점</option>
                <option value="5" selected>5점</option>
            </select>

            <br>
            <br>
            실용성
            <select class="form-select group" id="select2" aria-label="Default select example"
                    style="display: initial">
                <option value="1">1점</option>
                <option value="2">2점</option>
                <option value="3">3점</option>
                <option value="4">4점</option>
                <option value="5" selected>5점</option>
            </select>

            <br>
            <br>

        </div>
        <div class="right">
            접근성
            <select class="form-select group" id="select3" aria-label="Default select example"
                    style="display: initial">
                <option value="1">1점</option>
                <option value="2">2점</option>
                <option value="3">3점</option>
                <option value="4">4점</option>
                <option value="5" selected>5점</option>
            </select>

        </div>
        <button type="button" class="reviewbtn" onclick="postReview('{{ user_info.username }}')">리뷰저장</button>
    </div>
{% endif %}

</div>

    </body>
</html>